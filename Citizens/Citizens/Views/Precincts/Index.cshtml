@section Scripts{
    <script src="~/Scripts/Citizen/Services/streetServices.js"></script>
    <script src="~/Scripts/Citizen/Services/precinctServises.js"></script>
    <script src="~/Scripts/Citizen/Controllers/precinctControllers.js"></script>
    <script src="~/Scripts/Citizen/Services/cityServices.js"></script>
    <script src="~/Scripts/AngularUtils/directives/angular-scrollable-table.min.js"></script>
    <script src="~/Scripts/AngularUtils/directives/ui-bootstrap-custom-tpls-0.12.1.min.js"></script>
    <link href="~/Content/css/scrollable-table.css" rel="stylesheet" />
}
<div ng-app="precinctControllers" ng-controller="listController">

    @Html.Partial("Alert")
    <h3>Дільниці</h3>
    <h5 ng-show="loading">Завантаження... <i class="fa fa-refresh fa-spin"></i></h5>
    <hr>
    <div class="row form-inline">
        <div class="col-md-6">
            <label>Пошук:</label>
            <input ng-model="query[queryBy]" type="text" class="form-control" placeholder="Введіть слово">
            <label>по:</label>
            <select ng-model="queryBy" ng-change="query={}" class="form-control">
                <option ng-repeat="option in options|optionsForAddresses:precinctEditing" value="{{option.value}}">{{option.desc}}</option>
            </select>
        </div>
        <div class="col-md-6">
            <button ng-click="addNewPrecinct()" class="btn btn-success">
                <span class="glyphicon glyphicon-plus"></span> Створити нову дільницю
            </button>
        </div>
    </div>
    <hr>
    <table ng-hide="precinctEditing" class="table table-striped table-condensed">
        <thead>
            <tr>
                <th ng-repeat="thName in tableHead">{{thName}}</th>
            </tr>
        </thead>
        <tbody>
            <tr dir-paginate="precinct in precincts | filterByFirstChar: query | itemsPerPage: pageSize" current-page="currentPage">
                <td>{{ getIndex(precinct) + 1 }}</td>
                <td>{{ precinct.Id }}</td>
                <td>{{ precinct.City.CityType.Name }} {{ precinct.City.Name }}</td>
                <td>{{ precinct.Street.StreetType.Name }} {{ precinct.Street.Name }}</td>
                <td>{{ precinct.House }}</td>
                <td>{{ precinct.District.Number }}</td>
                <td>
                    <button class="btn btn-xs" ng-click="edit(precinct)" title="Редагувати">
                        <span class="glyphicon glyphicon-edit"></span>
                    </button>
                    @*<button class="btn btn-xs" ng-click="details(precinct)" title="Детально">
                            <span class="glyphicon glyphicon-info-sign"></span>
                        </button>*@
                    <button class="btn btn-xs" ng-click="delete(precinct)" title="Видалити">
                        <span class="glyphicon glyphicon-trash"></span>
                    </button>
                </td>
            </tr>
        </tbody>
    </table>
    <div ng-show="precinctEditing" ng-include="'PrecinctAddresses'"></div>
    @Html.Partial("Pagination")

    <script type="text/ng-template" id="PrecinctAddresses">
        <div class="container">
            <form ng-submit="save()">
                <div class="row form-horizontal">
                    <div class="form-group col-lg-2">
                        <label>Дільниця</label>
                        <input ng-model="selected.precinct.Id" type="text" class="form-control" required>
                    </div>
                    <div class="form-group col-lg-3">
                        <label>Населений пункт</label>
                        <select class="form-control" ng-options="c.Id as c.CityType.Name +' '+c.Name for c in cities"
                                ng-model="selected.precinct.CityId">
                            <option value='' disabled>-Необхідно вибрати-</option>
                        </select>
                    </div>
                    <div class="form-group col-lg-4">
                        <label>Вулиця</label>
                        @*<select class="form-control" ng-options="s.Id as s.StreetType.Name +' '+ s.Name for s in streets"
                                    ng-model="selected.precinct.StreetId">
                                <option value='' disabled>-Необхідно вибрати-</option>
                            </select>*@
                        <input type="text" typeahead-on-select="onSelectStreet($item, $model, $label)" ng-model="selected.precinct.Street" typeahead="s.Id as s.StreetType.Name +' '+ s.Name for s in streets | filter: $viewValue| limitTo:10" class="form-control">
                    </div>
                    <div class="form-group col-lg-2">
                        <label>Буд.</label>
                        <input ng-model="selected.precinct.House" type="text" class="form-control">
                    </div>
                    <div class="form-group col-lg-2">
                        <label>Округ</label>
                        <select class="form-control" ng-options="d.Id as d.Id for d in districts"
                                ng-model="selected.precinct.DistrictId">
                            <option value='' disabled>-Необхідно вибрати-</option>
                        </select>
                    </div>
                </div>
                <div class="row">
                    <button type="submit" class="btn btn-sm btn-success" title="Зберегти зміни">
                        <span class="glyphicon glyphicon-save"></span> Зберегти
                        <i ng-show="saving" class="fa fa-refresh fa-spin"></i>
                    </button>
                    <button class="btn btn-sm btn-success" ng-click="backToList()" title="Повернутися до списку дільниць">
                        <span class="glyphicon glyphicon-backward"></span> Завершити
                    </button>
                </div>
            </form>
        </div>
        <hr>
        <div class="container">
            <label>Автоматичне заповнення адрес:</label>
            <div class="row">
                <form ng-submit="autoCompleteAddresses()">
                    <div class="form-group col-lg-3">
                        <select class="form-control" ng-options="c.Id as c.CityType.Name +' '+c.Name for c in cities"
                                ng-model="autocomplete.CityId" required>
                            <option value='' disabled>-Населений пункт-</option>
                        </select>
                    </div>
                    <div class="form-group col-lg-3">
                        @*<select class="form-control" ng-options="s.Id as s.StreetType.Name +' '+ s.Name for s in streets"
                                    ng-model="autocomplete.StreetId" required>
                                <option value='' disabled>-Вулиця-</option>
                            </select>*@
                        <input type="text" typeahead-on-select="onSelectAutocompleteStreet($item, $model, $label)" ng-model="autocomplete.Street" typeahead="s.Id as s.StreetType.Name +' '+ s.Name for s in streets | filter: $viewValue| limitTo:10" class="form-control" placeholder="Вулиця" required>
                    </div>
                    <div class="form-group col-lg-2">
                        <input class="form-control" ng-model="autocomplete.HouseFrom" placeholder="буд. з" required />
                    </div>
                    <div class="form-group col-lg-2">
                        <input class="form-control" ng-model="autocomplete.HouseTo" placeholder="буд. по" required />
                    </div>
                    <div class="form-group col-lg-2">
                        <button type="submit" class="btn btn-sm btn-success">
                            <span ng-show="!savingAddresses" class="glyphicon glyphicon-list"></span> Додати адреси
                            <i ng-show="savingAddresses" class="fa fa-refresh fa-spin"></i>
                        </button>
                    </div>
                </form>
            </div>
        </div>
        <scrollable-table watch="precinctAddresses">
            <table class="table table-striped table-bordered">
                <thead>
                    <tr>
                        <th>№</th>
                        <th>Населений пункт</th>
                        <th>Вулиця</th>
                        <th>Буд.</th>
                        <th>
                            <button ng-click="addNewAddress()" class="btn btn-sm btn-success">
                                <span class="glyphicon glyphicon-plus"></span> Додати адресу
                            </button>
                        </th>
                    </tr>
                </thead>
                <tbody>
                    <tr ng-show="addAddressMode" ng-include="'edit'"></tr>
                    <tr ng-repeat="address in precinctAddresses| filterByFirstChar: query" ng-include="getTemplate(address)"></tr>
                </tbody>
            </table>
        </scrollable-table>
        <script type="text/ng-template" id="display">
            <td>{{ $index + 1 }}</td>
            <td>{{address.City.CityType.Name}} {{address.City.Name}}</td>
            <td>{{address.Street.StreetType.Name}} {{address.Street.Name}}</td>
            <td>{{address.House}}</td>
            <td>
                <button class="btn btn-xs" ng-click="editAddress(address)" title="Редагувати">
                    <span class="glyphicon glyphicon-edit"></span>
                </button>
                <button class="btn btn-xs" ng-click="deleteAddress(address,$index)" title="Видалити">
                    <span class="glyphicon glyphicon-trash"></span>
                </button>
            </td>
        </script>
        <script type="text/ng-template" id="edit">
            <td>{{ $index + 1 }}</td>
            <td>
                <select class="form-control" ng-options="c.Id as c.CityType.Name +' '+c.Name for c in cities"
                        ng-model="selected.address.CityId">
                    <option value='' disabled>-Необхідно вибрати-</option>
                </select>
            </td>
            <td>
                @*<select class="form-control" ng-options="s.Id as s.StreetType.Name +' '+ s.Name for s in streets"
                            ng-model="selected.address.StreetId">
                        <option value='' disabled>-Необхідно вибрати-</option>
                    </select>*@
                <input type="text" typeahead-on-select="onSelectPrecinctAddressStreet($item, $model, $label)" ng-model="selected.address.Street" typeahead="s.Id as s.StreetType.Name +' '+ s.Name for s in streets | filter: $viewValue| limitTo:10" class="form-control" placeholder="Вулиця">
            </td>
            <td><input class="form-control" ng-model="selected.address.House" /></td>
            <td>
                <button ng-click="saveAddress(address,$index)" class="btn btn-sm btn-success" title="Зберегти зміни">
                    <span class="glyphicon glyphicon-save"></span>
                    <i ng-show="savingAddress" class="fa fa-refresh fa-spin"></i>
                </button>
                <button class="btn btn-sm btn-success" ng-click="resetAddress()" title="Відмінити зміни">
                    <span class="glyphicon glyphicon-remove"></span>
                </button>
            </td>
        </script>
</div>

